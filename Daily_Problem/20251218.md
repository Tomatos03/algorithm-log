# [3652. 按策略买卖股票的最佳时机](https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-using-strategy/)

## 解题思路

1. 预处理两个数组$price[i]$的前缀数组$pre_0$, $price[i] * strategy[i]$的前缀和数组$pre_1$ 
2. 假设从第$i$天开始进行连续$k$个修改, 那么这次修改的利润为$pre_1[i - 1] + (pre_1[n] - pre_1[i + k - 1]) + (pre_0[i + k - 1] - pre_0[i + \frac{k}{2}])$


```cpp
// 时间复杂度O(n)
using i64 = long long;
class Solution {
public:
    long long maxProfit(vector<int>& prices, vector<int>& strategy, int k) {
        int n = prices.size();
        vector<i64> suf_v(n + 1), suf_w(n + 1);
        for (int i = n - 1; i >= 0; --i) {
            suf_v[i] = suf_v[i + 1] + prices[i];
            suf_w[i] = suf_w[i + 1] + prices[i] * strategy[i];
        }
        i64 pre_sum = 0, ans = suf_w[0];
        for (int i = 0; i <= n - k; ++i) {
            ans = max(ans, pre_sum + suf_w[i + k] + (suf_v[i + k / 2] - suf_v[i + k]));
            pre_sum += prices[i] * strategy[i];
        }
        return ans;
    }
};


```

