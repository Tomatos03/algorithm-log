# [2043. 简易银行系统](https://leetcode.cn/problems/simple-bank-system/)

## 解题思路

1. 本题难点在于转账, $A$对$B$转账$money$元可以转换为$A$取款$money$元, $B$存款$money$, 由于转账是一个原子操作, 要么成功, 要么失败, 如果存在一半成功必须进行回滚操作

## 参考代码


```cpp
using i64 = long long;
class bank {
    vector<i64> b;
    int n;
public:
    bank(vector<long long>& balance) {
        b = balance;
        n = b.size();
    }
    
    bool transfer(int account1, int account2, long long money) {
        bool op1 = withdraw(account1, money), op2 = deposit(account2, money);
        bool result = op1 && op2;
        if (!result) {
            if (op1)
                deposit(account1, money); // 回滚操作
            if (op2)
                withdraw(account2, money); // 回滚操作
            return false;
        }
        return true;
    }
    
    bool deposit(int account, long long money) {
        int i = account - 1;
        if (noinrange(account))
            return false;
        b[i] += money;
        return true;
    }
    
    bool withdraw(int account, long long money) {
        int i = account - 1;
        if (noinrange(account) || b[i] < money)
            return false;
        b[i] -= money;
        return true;
    }

    bool noinrange(int x) {
        return x > n;
    }
};

```
