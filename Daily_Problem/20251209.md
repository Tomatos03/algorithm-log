# [3583. 统计特殊三元组](https://leetcode.cn/problems/count-special-triplets/)

## 解题思路

1. 将数组下标按照下标对应的值进行分组
1. 对于一个确定的值$v$(对应下标为$j$) , 需要查找分组之后是否包含$2v$, 如果不包含那么$v$就不存在任何一个特殊三元组, 如果存在则需要在$2v$对应的组中找到满足$i < j, j < k$的所有位置, 通过公式$(i + 1) \times (n - k)$计算贡献

## 参考代码


```cpp
// 时间复杂度O(nlogn)
class Solution {
    const int mod = 1e9 + 7;
public:
    int specialTriplets(vector<int>& nums) {
        unordered_map<int, vector<int>> mp;
        int n = nums.size();
        for (int i = 0; i < n; ++i) {
            mp[nums[i]].push_back(i);
        }
        int cnt = 0;
        for (auto [v, vec] : mp) {
            if (!mp.count(2 * v))
                continue;

            int size = vec.size();
            // v = 0时满足这个条件
            if (v == 2 * v) {
                if (size >= 3)
                    cnt = (cnt + 1LL * size * (size - 1) * (size - 2) / 6 % mod) % mod;
                continue;
            }

            vector<int> &vec0 = mp[2 * v];
            for (int &pos : vec) {
                int k = upper_bound(vec0.begin(), vec0.end(), pos) - vec0.begin();
                int i = lower_bound(vec0.begin(), vec0.end(), pos) - vec0.begin() - 1;
                int size0 = vec0.size();
                if (0 <= i && k < size0)
                    cnt = (cnt + 1LL * (i + 1) * (size0 - k) % mod) % mod;
            }
        }
        return cnt;
    }
};
```

