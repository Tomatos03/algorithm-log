# [3397. 执行操作后不同元素的最大数量](https://leetcode.cn/problems/maximum-number-of-distinct-elements-after-operations/)

## 解题思路

1. 总是优先将数通过操作变为能够变为的最小的那个数
1. 对于不同的两个数$a, b, a < b$, $b$不可能通过操作覆盖$a$通过操作的得到的所有数, 因为$a$通过操作得到的数的取值为$[a - k, a + k]$, $b$通过操作得到的数的取值为$[b - k, b + k]$, 其中$a - k < b - k$
1. 从小到大排序数组, 记录每一个数出现的次数并去除重复元素, 对于每一个数$a$, 总是优先通过操作从$a - k$开始逐渐递增制造新数. 这里可能与上一个数制造的数重复, 所以还需要记录上一次制造的最大数是多少, 然后在计算当前数的时候考虑是否需要去重 

## 参考代码

+ 时间复杂度$O(n\log n)$


```cpp
using i64 = long long;
class Solution {
public:
    int maxDistinctElements(vector<int>& nums, int k) {
        int n = nums.size();
        map<int, int> mp;
        for (int &v : nums) {
            mp[v]++;
        }
        int pre_v = INT_MIN / 2, ans = 0;
        for (auto [v, cnt] : mp) {
            int start_v = max(pre_v + 1, v - k);
            int end_v = min(start_v + cnt - 1, v + k);

            ans += end_v - start_v + 1;
            pre_v = end_v;
        }
        return ans;
    }
};

```
